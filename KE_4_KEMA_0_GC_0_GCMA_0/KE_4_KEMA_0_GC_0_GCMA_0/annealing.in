# Variable                                                                                                                              
variable		npt_step	equal	20000000           # 10 ns                                                                            
variable		npt_thermo	equal	${npt_step}/100    # output 100 frame                                                                 
units           real                                                                                                                    
variable        filename    string  KE_4_KEMA_0_GC_0_GCMA_0_autopsf_solvate_ionzied.data
                                                                                                                                        
# Potential define                                                                                                                      
atom_style      full                                                                                                                    
bond_style      harmonic                                                                                                                
angle_style     charmm                                                                                                                  
dihedral_style  charmmfsw                                                                                                               
improper_style  harmonic                                                                                                                
# pair_style      lj/charmmfsw/coul/charmmfsh 10 12                                                                                     
pair_style      lj/charmmfsw/coul/long 10 12                                                                                            
kspace_style    pppm 1e-6                                                                                                               
pair_modify     mix arithmetic                                                                                                          
                                                                                                                                        
# Modify following line to point to the desired CMAP file                                                                               
fix             cmap all cmap ../../0_minimized_npt/charmm36.cmap                                                                          
fix_modify      cmap energy yes                                                                                                         
read_data       ${filename} fix cmap crossterm CMAP                                                                                        
pair_coeff      33 36 0.154919 3.24019863787641 0.154919 3.24019863787641

special_bonds   charmm                                                                                                                  
                                                                                                                                        
# Minimized                                                                                                                             
neigh_modify    every 1 delay 0 check yes                                                                                               
min_style       cg                                                                                                                      
minimize        0.0 1.0e-9 100000 1000000                                                                                                  
write_data      minimized.data pair ij                                                                                                  
                                                                                                                                        
# Setup                                                                                                                                 
                                                                                                                                        
neigh_modify    delay 2 every 1                                                                                                         
restart 		${npt_thermo} ./restart/npt.restart                                                                                       
dump            1 all dcd ${npt_thermo} npt.dcd                                                                                         
dump_modify     1 unwrap yes                                                                                                            
thermo          ${npt_thermo}                                                                                                           
thermo_style    custom step time xlo xhi ylo yhi zlo zhi etotal pe ke ebond temp press eangle edihed eimp evdwl ecoul elong vol density 
                                                                                                                                        
# NPT 400K                                                                                                                              
reset_timestep  0                                                                                                                         
fix             2 all shake 1e-6 500 0 m 1.0 a 141                                                                      
fix 			1 all npt temp 400.0 400.0 100.0 iso 1 1 1000.0   

timestep        0.5                                                                                                                     
run             ${npt_step}                                                                                                             
                                                                                                                                        
# NPT 400K to 300K                                                                                                                      
unfix           1                                                                                                                       
fix 			1 all npt temp 400.0 300.0 100.0 iso 1 1 1000.0                                                                           
timestep        1                                                                                                                       
run             ${npt_step}                                                                                                             
                                                                                                                                        
# NPT 300K                                                                                                                              
unfix           1                                                                                                                       
unfix           2                                                                                                                       
fix 			1 all npt temp 300.0 300.0 100.0 iso 1 1 1000.0                                                                           
timestep        1                                                                                                                       
run             ${npt_step}                                                                                                             
                                                                                                                                        
write_data      npt_out.data pair ij                                                                                                    
